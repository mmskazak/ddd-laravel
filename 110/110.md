Существуют два популярных паттерна:

Я использую название `upsert` почти для всех моих действий.
Оно может использоваться как для создания, так и для обновления подписчика.

В такого рода действиях я всегда использую метод Eloquent `updateOrCreate`.
Он принимает два массива:

* Первый используется в `select`-запросе.
  Если запись найдена с этими значениями — будет выполнен `update`.
  Если не найдена — будет выполнен `insert`.

* Второй содержит атрибуты, которые будут вставлены или обновлены.

У каждого DTO есть метод `all`, который возвращает свойства как массив.
Это удобный метод, и его можно использовать с Eloquent, как в этом примере.
Но когда у тебя есть вложенные свойства, массив будет выглядеть так:

```php
[
    'first_name' => 'John',
    'last_name' => 'Doe',
    'form' => [
        'id' => 1,
        'title' => 'Some Form',
        'content' => '...',
    ],
]
```

Очевидно, мы не можем сохранить весь массив `form`;
нам нужен только `id`. Вот почему второй аргумент метода `updateOrCreate`
собран таким способом.

Martin Joo — Предметно-ориентированное проектирование с Laravel
Стр. 109 / 327
