## Автоматизации

Последняя важная функция, которую я хочу смоделировать перед тем, как двигаться дальше — это автоматизация.
Как я говорил ранее, нам нужно строить потоки, вроде следующего:

> «Когда человек подписывается на мой e-mail список — добавить его в мою классную e-mail последовательность.»

На уровне базы данных это реализуется довольно просто.
Я считаю, что нам нужно всего две таблицы, чтобы представить такую автоматизацию.

+----+---------------------+
| id | name                |
+----+---------------------+
| 1  | Add to newsletter   |
+----+---------------------+

Более интересная часть — это **шаги** этой автоматизации:

+----+----------------+--------+------------------+---------------------------+
| id | automation_id  | type   | name             | value                     |
+----+----------------+--------+------------------+---------------------------+
| 1  | 1              | event  | subscribedToForm | {"form_id": 1}            |
| 2  | 1              | action | addToSequence    | {"sequence_id": 3}        |
+----+----------------+--------+------------------+---------------------------+

* Первая строка представляет **событие**, то есть часть:
  *«Когда человек подписывается на мой e-mail список»*

* Вторая строка — это само **действие**, то есть часть:
  *«добавить его в мою классную e-mail последовательность»*

Колонки `type` и `name` говорят сами за себя.
А колонка `value` содержит ID «объекта», с которым нужно работать.

Снова используется **JSON-колонка**.
Хотя в этих двух примерах можно было бы обойтись обычным числом,
что произойдёт, если появятся более сложные шаги, вроде:

> «Когда подписчик покупает определённый продукт, подождать два дня и отправить e-mail с апселлом.»

В таком случае **JSON-колонка реально пригодится**.
С другой стороны, **в простых случаях мы ничего не теряем**, используя её.

---

Как ты видишь, это довольно простая структура БД.
Но в коде мы столкнёмся с некоторыми интересными задачами.

Martin Joo — Предметно-ориентированное проектирование с Laravel
Стр. 83 / 327
