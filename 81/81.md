## Последовательности

Теперь мы можем перейти к последовательностям. Идея снова проста:

У нас есть последовательность, содержащая несколько e-mail'ов.
Каждое из этих писем имеет собственную логику планирования.

Нам нужно обрабатывать два разных типа единиц времени при планировании писем последовательности:

* Часы
* Дни

Так что пользователи могут создавать расписания вроде:

* Через пять дней после последнего письма
* Через два часа после предыдущего письма

Также они хотят указать, **в какие дни** это письмо может быть отправлено:

* Через пять дней после последнего письма, **но только по пятницам**
* Через два часа после предыдущего письма **в любой день**

---

Прежде чем моделировать таблицы, давай обсудим, как хранить эти расписания:

+-------+--------+------------------------------------------------------------------------------------------------------------------+
| delay | unit   | allowed_days                                                                                                     |
+-------+--------+------------------------------------------------------------------------------------------------------------------+
|   5   | days   | {"monday": false, "tuesday": false, "wednesday": true, "thursday": false,                                        |
|       |        |  "friday": false, "saturday": false, "sunday": false}                                                            |
|   2   | hours  | {"monday": true, "tuesday": true, "wednesday": true, "thursday": true,                                           |
|       |        |  "friday": true, "saturday": false, "sunday": false}                                                             |
+-------+--------+------------------------------------------------------------------------------------------------------------------+


Атрибуты следующие:

* `delay` — хранит количество дней или часов, которое нужно подождать после предыдущего письма.
* `unit` — это либо `"days"`, либо `"hours"`.
  Эту колонку можно опустить, если хранить все значения `delay` в **часах**.
  В таком случае, пять дней станут 120 часами. Это может сработать,
  но если таблица имеет отдельную колонку `unit`, то в коде не нужно конвертировать часы в дни и обратно.
  **На мой взгляд, так проще.**

Martin Joo — Предметно-ориентированное проектирование с Laravel
Стр. 80 / 327
