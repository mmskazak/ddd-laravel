## SentMails

Продолжим. Что происходит после того, как рассылка отправлена?
Из пользовательских историй мы знаем, что нам нужно формировать отчёты вроде:

* Общее количество отправленных писем
* Открываемость
* Кликабельность

Значит, нам нужно что-то, что представляет собой **отправленное письмо**.
После отправки рассылки будет разослано X писем, и нам нужно создать X записей в таблице,
где X — количество подписчиков.
То же самое требуется для писем в последовательностях, поэтому и для них нужна аналогичная логика.
Нам нужна таблица с **полиморфной связью**.

Что представляет собой эта таблица?
Как я уже говорил, она хранит письма, которые уже были отправлены,
поэтому я предлагаю назвать её `sent_mails`.

+----+-------------+----------------+---------------+---------------------+---------------------+---------------------+
| id | sendable_id | sendable_type  | subscriber_id | sent_at             | opened_at           | clicked_at          |
+----+-------------+----------------+---------------+---------------------+---------------------+---------------------+
|  1 |           1 | Broadcast      |           101 | 2022-04-22 13:00:00 | 2022-04-22 13:11:00 | 2022-04-22 13:12:00 |
|  2 |           1 | Broadcast      |           129 | 2022-04-22 13:00:00 | 2022-04-22 13:24:00 |                     |
|  3 |           4 | SequenceMail   |           411 | 2022-04-25 09:13:00 |                     |                     |
+----+-------------+----------------+---------------+---------------------+---------------------+---------------------+


Так как таблица называется `sent_mails`, я решил использовать имя **`sendable`**
в качестве названия для полиморфной связи.
Колонка `sendable_type` будет содержать **полное имя класса** моделей,
которые пока точно не определены, поэтому я просто указал предполагаемые имена.

**Tracking API** будет обновлять колонки `opened_at` и `clicked_at` для указанного
подписчика и `sendable`. Из этой таблицы мы можем рассчитывать метрики.
Например, эффективность рассылки:

* Отправлено: 2 письма
* Открываемость: 100%
* Кликабельность: 50%

Martin Joo — Предметно-ориентированное проектирование с Laravel
Стр. 76 / 327
