+-------------+             +--------------------+             +---------------------------+
|  sequences  |             |   sequence_mails   |             |  sequence_mail_schedules  |
+-------------+             +--------------------+             +---------------------------+
| title       |<----------- | sequence_id        |<----------- | sequence_mail_id          |
| status      |             | subject            |             | delay                     |
+-------------+             | content            |             | unit                      |
                            | filters            |             | allowed_days              |
                            +--------------------+             +---------------------------+
                                   |
                                   v
                           +------------------+
                           |    sent_mails    |
                           +------------------+
                           | sendable_id      |
                           | sendable_type    |
                           | subscriber_id    |
                           +------------------+
                                   |
                                   v
                           +------------------+
                           |   subscribers    |
                           +------------------+

Вот текстовая (ASCII) репрезентация структуры из схемы:

```
+-------------+             +--------------------+             +---------------------------+
|  sequences  |             |   sequence_mails   |             |  sequence_mail_schedules  |
+-------------+             +--------------------+             +---------------------------+
| title       |<----------- | sequence_id        |<----------- | sequence_mail_id          |
| status      |             | subject            |             | delay                     |
+-------------+             | content            |             | unit                      |
                            | filters            |             | allowed_days              |
                            +--------------------+             +---------------------------+
                                   |
                                   v
                           +------------------+
                           |    sent_mails    |
                           +------------------+
                           | sendable_id      |
                           | sendable_type    |
                           | subscriber_id    |
                           +------------------+
                                   |
                                   v
                           +------------------+
                           |   subscribers    |
                           +------------------+
```

**Связи:**

* `sequences` → `sequence_mails`: один ко многим
* `sequence_mails` → `sequence_mail_schedules`: один ко одному
* `sequence_mails` → `sent_mails` (полиморфно)
* `sent_mails.subscriber_id` → `subscribers`

Это довольно просто. Письмо из последовательности очень похоже на рассылку; оно тоже имеет:

* Тему письма (Subject line)
* HTML-содержимое
* JSON-фильтры

**Последовательность** — это просто «контейнер» с именем и статусом.
Но она важна, потому что только **опубликованные последовательности** могут отправлять письма подписчикам.
И, как мы обсуждали ранее, каждое письмо из последовательности становится строкой в таблице `sent_mails` после отправки.

Martin Joo — Предметно-ориентированное проектирование с Laravel
Стр. 82 / 327

