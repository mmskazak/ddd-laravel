## Небольшая заметка о производительности

А теперь давай немного поиграем с числами. Сначала сделаю несколько предположений:

* В нашем приложении будет около **100 000 пользователей**
* У каждого пользователя в среднем **список из 5000 подписчиков**
* Они отправляют **в среднем 1 письмо в неделю**

Итак:

**100 000 пользователей × 5000 писем × 52 недели = 26 000 000 000 строк в таблице `sent_mails` за один год**.
Звучит невероятно много, правда? Давай сделаем другие допущения:

* Получить 100 000 пользователей, вероятно, займёт **ГОДЫ**. Это зависит от множества факторов,
  но это очень большое число. У ConvertKit около 500 000 пользователей
  (эта цифра взята с их сайта), и это бизнесу **около 8 лет**, причём в нише,
  где CEO очень известен.

* 5000 — это абсолютно **вымышленное число**; я не нашёл надёжного источника онлайн.

---

На этом этапе я **не стал бы переживать** о подобных проблемах.
Вместо этого я хочу быть готовым к первым **100 или 1000 пользователям**.
Что мы можем сделать, чтобы база данных работала эффективно?

* Создать индексы по колонкам `sent_at`,
* а также по `opened_at` и `clicked_at`.

Сами по себе индексы уже могут ускорить твоё приложение.
Следующий шаг — писать **запросы, которые используют эти индексы**.
Поэтому **никогда** не пиши что-то вроде:

```sql
select count(*)
from sent_mails
where year(sent_at) = "2022";
```

---

Этот запрос **не будет использовать индекс по `sent_at`**,
потому что MySQL **не использует индексы**, если ты применяешь функцию (`year`) к колонке.
Вместо использования функции, пиши запросы вот так:

```sql
select count(*)
from sent_mails
where sent_at between '2022-01-01' and '2022-12-31';
```

Martin Joo — Предметно-ориентированное проектирование с Laravel
Стр. 78 / 327

---

Кидай следующую страницу — не сбавляй темп!
